# 分析应用
前提条件：默认普通用户已通过管理员用户获取分析应用的所有权限，包括数据应用、数据模块、算法定制的查看及创建权限。
说明：创建权限包含新建、编辑、删除、运行和复制的权限。
## 数据应用
前提条件：普通用户已具备数据模块的查看和创建权限。
### 新建数据应用
用户可以根据自己的需求新建数据应用。新建数据应用需完成以下步骤：

1.单击页面左侧导航栏“数据应用”，系统跳转到“数据应用”界面。

2.单击页面右上角的“新建”按钮，弹出“新建数据应用”窗口。用户根据需求填写如下配置项。
![](/user_guide/fig/fig_03.png)
    
| 配置项 | 说明 |
| :--- | :--- | 
| 名称 | 数据应用的名称。 |
| 描述 | 对新建数据应用的简要描述。 |
| 私有（可选） | 勾选“私有”表示新建的数据应用为私有属性，只有创建者、管理员用户或者被赋予数据应用查看和“创建”权限的用户才可以查看。不勾选“私有”表示该数据应用为公有属性，任何用户都具备查看的权限。 |

3.填写完成后，单击“确定”，系统跳转到数据应用界面，单击 “数据应用缩略图”>“打开工作流”，进入工作流编辑界面。
工作流编辑界面分为模块区、画布区、小地图等。 
![](/user_guide/fig/fig_04.png)
    
* 模块区：为数据模块库和分析模块库，用户可根据需求拖拽使用。系统内置部分数据模块和分析模块，用户也可以根据自己的需求新建数据模块和分析模块。参见《数据模块》和《分析模块》。
* 画布区：为工作流组建区。
* 小地图：界面右上方小地图区域可呈现整个工作流，拖动灰色方块可定位工作流具体位置。

4.从左侧数据模块库中拖拽数据模块和分析模块到工作流画布中。
将鼠标置于数据模块上可弹出加号，单击加号，系统自动弹出分析模块下拉框，下拉框中模块会自动匹配上级模块的输出类型，便于用户选取。同时，平台支持直接从左侧模块库中拖拽模块至工作区域，需确保模块输入类型与上级模块的输出类型相匹配。

5.按住鼠标左键将模块的输出和下级模块的输入相连接，连线成功后表明模块之间通过数据耦合的方式连接在一起，形成分析工作流。
   
  - 将鼠标置于模块右上方区域可弹出该模块当前的版本号。
  - 单击画布右上方![](/user_guide/icon/remark.png)按钮，可对模块进行备注，方便他人理解。同时，单击![](/user_guide/icon/hide.png)可对备注进行隐藏或者可见。

6.新建工作流完成后，单击页面右上方“保存”按钮，对该工作流进行保存。

7.版本控制。单击保存后，系统自动生成版本号，默认为0.0版本，不支持自定义版本信息；编辑数据应用工作流时，只有进行添加或者删除模块操作时，单击“保存”后，系统自动升级版本，梯度为+0.1。

8.创建者可对该数据应用工作流进行权限设置。单击“更多”>“权限设置”，弹出“修改权限”对话框。用户可通过勾选用户或用户分组及权限完成权限设置。
    ![](/user_guide/fig/fig_05.png)
    如上图表示用户demo@TEST.COM及算法分析师组对该数据应用只具有读取的权限。

9.权限设置完成后，运行数据应用。在工作流页面单击右上方“运行”按钮，弹出“应用运行配置”对话框，用户根据需求填写相关信息。
    ![](/user_guide/fig/fig_06.png)
    <table>
   <tr>
      <td>配置项</td>
      <td colspan="2">说明</td>
   </tr>
   <tr>
      <td>任务名称</td>
      <td colspan="2">数据应用工作流运行后的任务名称。</td>
   </tr>
   <tr>
      <td>描述</td>
      <td colspan="2">对该任务的简要描述。</td>
   </tr>
   <tr>
      <td>运行模式</td>
      <td>无</td>
      <td>N/A</td>
   </tr>
   <tr>
      <td></td>
      <td>稍后运行：指定一个相对时间稍后运行。</td>
      <td>开始时间：开始运行数据应用的时间。</td>
   </tr>
   <tr>
      <td></td>
      <td>定期运行：指定一个时间间隔周期运行。</td>
      <td><ul>
  <li>开始时间：第一次开始运行数据应用的时间。</li>
  <li>定期模式：周期运行的运行间隔。</li>
  <li>过期时间：定期运行结束时间。</li>
   <li>执行方式<ul>
  <li>顺序执行：定时任务到期时必须等待之前的任务完成，才能运行新任务</li>
  <li>并行执行：定时任务到期就会运行一个新的任务，不管之前的任务是否完成</li>
</ul></li>
</ul></td>
   </tr>
</table>
    
10.填写完成后，单击“运行”，系统跳转到“任务列表”界面。
![](/user_guide/fig/fig_07.png)

### 查看数据应用
单击“服务”>“分析应用”，系统跳转到分析应用界面，系统默认为数据应用界面，展示当前用户权限下的“全部”数据应用缩略图，包括数据应用名称和描述信息。单击页面右上方“自己”按钮，可查看用户自己创建的数据应用缩略图。
![](/user_guide/fig/fig_08.png)

鼠标在某数据应用上停留片刻，会出现数据应用相关信息与操作，包括运行次数、最后一次修改时间、创建人信息；同时支持对该数据应用进行复制、运行和删除的操作按钮。

### 复制数据应用
用户可以复制已有的数据应用以便使用该数据应用的业务实现及配置。复制数据应用需完成以下步骤：

1.将鼠标停留在某数据应用缩略图片刻，单击“复制”，弹出“复制数据应用”对话框。
![](/user_guide/fig/fig_09.png)

| 配置项 | 说明 |
| :--- | :--- |
| 数据应用名称 | 复制后的数据应用名称。 |
| 描述 | 对复制后的数据应用的简要描述。 |
| 私有（可选） | 勾选“私有”表示新建的数据应用为私有属性，只有创建者、管理员用户或者被赋予数据应用查看和“创建”权限的用户才可以查看。 |

2.填写配置项。

3.单击“复制”，系统跳转到数据应用界面。

### 编辑数据应用
前提条件：当且仅当创建者对该数据应用进行了权限设置，其他用户才可能对该数据应用具备编辑权限。
#### 查看详情
1.单击页面左侧导航栏“数据应用”，系统跳转到“数据应用”界面。

2.单击需要编辑的数据应用缩略图，进入数据应用详情界面，用户可查看数据应
    ![](/user_guide/fig/fig_10.png)

* 用户可查看该工作流的修改记录，包括项目更新记录、公私有属性记录；
* 用户可对该工作流进行评价并查看其他用户的评价；
* 用户可以查看该工作流的名称、描述、更新时间、创建人和运行次数。
* 用户可以查看数据模块和分析模块名称及数量；
* 用户可以添加对数据应用的详细描述；支持markdown语法。

#### 编辑工作流
用户可以编辑当前数据应用，单击工作流详情页面右上方“打开工作流”，系统跳转到工作流编辑页面。

**编辑工作流**

用户可对该工作流进行编辑，用户可对模块进行调整，包括增加模块、删除模块、编辑模块等；
![](/user_guide/fig/fig_11.png)    

**编辑数据模块**

单击数据模块，弹出编辑模块对话框，可添加和修改模块别名。
![](/user_guide/fig/fig_12.png)

**修改数据模块参数**

单击分析模块，弹出编辑模块对话框，可添加和修改模块别名，同时支持查看资源配置情况，包括CPUS、MEM。
![](/user_guide/fig/fig_13.png)

**编辑描述和共享性**

单击“更多”>“编辑应用”，可对模块的描述和共享性进行修改。
![](/user_guide/fig/fig_14.png)

## 数据模块
前提条件：普通用户已具备数据模块的读取权限。
### 新建数据模块
用户可以根据自己的需求新建数据模块。新建数据模块需完成以下步骤：

1.单击页面左侧导航栏“数据模块”，系统跳转到“数据模块”界面。

2.单击页面右上角的“新建”按钮，弹出“创建数据模块”窗口。用户根据需求填写如下配置项。
    ![](/user_guide/fig/fig_15.png)
    
  <table>
   <tr>
      <td >配置项</td>
      <td colspan="2" >说明</td>
   </tr>
   <tr>
      <td rowspan="3">选择类型</td>
      <td>Localfile</td>
      <td>添加数据文件：选择本地数据文件</td>
   </tr>
   <tr>
      <td>HDFS</td>
      <td><p>HDFS:格式类型</p><p>hdfs://+地址</p></td>
   </tr>
   <tr>
      <td>Hive</td>
      <td><p>HIVE:格式类型</p><p>host=?,port=?,database=?,table=?</p></td>
   </tr>
   <tr>
      <td>名称</td>
      <td colspan="2">数据模块的名称。</td>
   </tr>
   <tr>
      <td>描述（可选）</td>
      <td colspan="2" >对数据模块的简要描述。</td>
   </tr>
   <tr>
      <td>标签（可选）</td>
      <td colspan="2">对数据模块按照标签分类。</td>
   </tr>
   <tr>
      <td>私有（可选）</td>
      <td colspan="2">勾选“私有”表示新建的数据模块为私有属性，只有创建者、管理员用户或者被赋予数据模块查看和“创建”权限的用户才可以查看和编辑。</td>
   </tr>
</table>

3.填写配置项，完成后单击“确定”。

4.系统生成数据模块，自动跳转到数据模块详情界面。
   ![](/user_guide/fig/fig_16.png)

5.创建者可对模块进行权限设置，单击页面右上方“权限设置”>“添加”，弹出“修改权限”对话框，用户可通过勾选用户或用户分组及权限完成权限设置。
![](/user_guide/fig/fig_17.png)

如上图表示用户admin@TEST.COM及算法分析师组对该数据应用具有读取的权限。
### 查看数据模块
单击“服务”>“分析应用”>“数据模块”，系统跳转到数据模块界面，用户可对数据源模块进行查看，通过点击上方分类标签进行模块筛选。APS内置部分开源模块库，用户可直接使用，模块功能可参见描述。
用户可通过“我的”“全部”查看数据模块列表。
* 我的：表示用户私有的数据模块列表。
* 全部：表示所有公有属性的模块列表，或者该用户具备查看权限的数据模块列表。
![](/user_guide/fig/fig_18.png)
在数据模块界面，单击模块名称，可查看数据模块详情、历史记录、引用记录并支持对该模块进行评论；同时支持模块创建人对模块进行编辑、删除和权限管理。

说明：不具备权限的用户对编辑、删除和权限设置按钮不可见。

**查看模块详情**

用户可查看数据模块的类型、版本号、描述、标签、创建人、更新时间、参数、输入、输出、公开程度和执行方式等信息。
![](/user_guide/fig/fig_19.png)

**查看历史记录**

用户可以查看该数据模块的所有版本信息，包括当前版本和历史版本的序号、名称、描述、版本号、创建人、修改时间和输出等信息。
![](/user_guide/fig/fig_20.png)

**引用记录**

用户可以查看该数据模块被数据应用工作流调用的情况，包括：项目编号、名称、描述、版本号及引用时间等。
![](/user_guide/fig/fig_21.png)

**评论**

用户可查看其他用户对模块的评论同时支持对该模块进行评论
在对话框中输入评语，单击“发布”即可生成一条评论。
![](/user_guide/fig/fig_22.png)

### 编辑数据模块
前提条件：当且仅当创建者对该数据模块进行了权限设置，被赋予查看权限的其他用户才能对查看该数据模块。

单击页面右上方“编辑”按钮，弹出“编辑”对话框，用户可编辑模块的描述信息。
![](/user_guide/fig/fig_23.png)

| 配置项 | 说明 |
| :--- | :--- |
| 描述 | 对复制后的数据应用的简要描述。 |
| 标签 | 对数据模块按照标签分类。 |
| 私有（可选） | 勾选“私有”表示该数据模块为私有属性，只有创建者、管理员用户或者被赋予数据应用查看和“创建”权限的用户才可以查看。 |

### 删除数据模块
单击页面右上方“删除”，弹出“删除模块”对话框，单击“删除”，即可删除该模块。

说明：此操作应谨慎进行，删除后不可恢复。
![](/user_guide/fig/fig_24.png)

## 分析模块
前提条件：普通用户已具备分析模块的查看和创建权限。

用户可以根据自己的需求新建分析模块。新建分析模块需要通过算法定制完成，即用户创建的算法模块在发布后即成为分析模块

### 查看分析模块
单击“服务”>“分析应用”>“数据模块”，系统跳转到数据模块界面，用户可对数据源模块进行查看，通过点击上方分类标签进行模块筛选。APS内置部分开源模块库，用户可直接使用，模块功能可参见描述。

用户可通过“我的”“全部”查看数据模块列表。

* 我的：表示用户私有的数据模块列表。
* 全部：表示所有公有属性的模块列表，或者该用户具备查看权限的数据模块列表。
![](/user_guide/fig/fig_25.png)

在分析模块界面，单击模块名称，可查看分析模块详情、历史记录、引用记录并支持对该模块进行评论；同时支持模块创建人和系统管理员对模块进行编辑、删除和权限管理。

说明：不具备权限的用户对编辑、删除和权限设置按钮不可见。

**查看模块详情**

用户可查看分析模块的版本号、描述、标签、创建人、更新时间、参数、输入、输出、公开程度和源文件等信息。
![](/user_guide/fig/fig_26.png)

**查看历史记录**

用户可以查看该分析模块的所有版本信息，包括当前版本和历史版本的序号、名称、描述、版本号、创建人、修改时间和输出等信息。
![](/user_guide/fig/fig_27.png)

**引用记录**

用户可以查看该分析模块被数据应用工作流调用的情况，包括：项目编号、名称、描述、版本号及引用时间等。
![](/user_guide/fig/fig_28.png)

**评论**

用户可查看其他用户对模块的评论同时支持对该模块进行评论
在对话框中输入评语，单击“发布”即可生成一条评论。
![](/user_guide/fig/fig_29.png)
### 编辑分析模块
前提条件：只有创建者和系统管理员可以对分析模块进行编辑。

击页面右上方“编辑”按钮，系统跳转到“算法定制”界面。 用户可对参数、输入、输出及代码进行编辑。发布成功后，版本升级同时模块名称不变。
![](/user_guide/fig/fig_30.png)

### 删除分析模块
单击页面右上方“删除”，弹出“删除模块”对话框，单击“删除”，即可删除该模块。

说明：此操作应谨慎进行，删除后不可恢复。
![](/user_guide/fig/fig_31.png)

### 设置分析模块权限
单击分析模块名称，弹出分析模块详情界面，单击右上角“权限设置”按钮，弹出“修改权限”对话框。

说明：仅创建者和管理账户具备编辑权限。
![](/user_guide/fig/fig_32.png)

## 算法定制

### 创建算法模块
单击页面左侧导航栏“算法定制”，系统跳转到“算法定制”界面。
![](/user_guide/fig/fig_33.png)

算法定制是指用户可以选择R、Python2.7、Python3.6等语言来编写轻量级应用分析模块，用户可根据需求选择语言。

1. 单击“新建”，弹出“新建模块”对话框，填写名称、描述，单击“确定”，系统跳转到算法编辑页面。
    ![](/user_guide/fig/fig_34.png)

<table>
   <tr>
      <td>配置项</td>
      <td colspan="2">说明</td>
   </tr>
   <tr>
      <td>名称</td>
      <td colspan="2">分析模块的名称。</td>
   </tr>
   <tr>
      <td>选择镜像</td>
      <td>模块运行的依赖环境</td>
      <td><p>minimal_python：仅包含python标准库。</p><p>zetdata_troy_python：除包含python标准库外，还引入了Pandas、Numpy、Sklearn等扩展库</p></td>
   </tr>
   <tr>
      <td>描述</td>
      <td colspan="2">对该分析模块的简要描述。</td>
   </tr>
</table>
   
2.填写完成后单击“确定”，系统跳转到算法编辑页面，支持用户自定义开发模块。

如下所示为一个Python语言算法定制的样例，在“文件管理”区域，“run.py”是由用户创建并编写的代码文件外，其它文件都是系统自动生成的文件。
![](/user_guide/fig/fig_35.png)

算法编辑页面主要分为四个区域：
<table>
   <tr>
      <td>区域划分</td>
      <td colspan="2">说明</td>
   </tr>
   <tr>
      <td>文件管理</td>
      <td>文件管理下的文件为算法程序文件，为系统自动生成的标准文件。文件列表中默认只有系统文件夹和文件，文件夹input和output，文件有spec.json、main.py（ main.R）、global.json、example、dependencies和readme.md，除readme.md外不可编辑</td>
     <td><li>Input下的文件存放测试时上传的文件，必须先在模块设置中定义“输入”然后再上传文件，Input下的文件个数不能超过定义的“输入”的个数。</li>
<li>Output文件夹下的文件是测试通过后输出的文件，默认为空；</li>
<li>spec.json文件：记录了算法的参数、输入、输出、私有、类型、版本、描述、名称和标签的信息，以及cmd信息；</li>
<li>main.py(main.R)用来记录runtime、CMD和entrypoint的信息；初始值为空，点击测试或者发布后才会有值；</li>
<li>Example文件：为静态文件，提供模块引用示例且内容不允许修改；</li>
<li>dependencies记录安装的程序包信息，初始信息为空；</li>
<li>readme.md为文件记录算法的说明，可以进行编辑内容，重命名或者删除。</li></td> 
   </tr>
   <tr>
      <td>模块设置</td>
      <td>可设置模块的参数、输入和输出，还支持上传和下载R/Ptyhon程序包。</td>
      <td>R在合法范围内可以输入任意值，但是R程序都按照字符串处理；Python支持三种参数类型：string、float、integer</td>
   </tr>
   <tr>
      <td>代码编辑区</td>
      <td colspan="2">分析模块的代码设计，支持代码高亮等。</td>
   </tr>
      <tr>
      <td>测试调试区</td>
      <td colspan="2">测试调试运行结果展示。</td>
   </tr>
</table>

3.参数设置。在模块设置区域填写模块的参数、输入和输出。
* **R语言传参模式及规则**
   
| 模块设置 | 输入格式 | 调用模式 |
| :--- | :--- | :--- |
| 参数 | 三个输入框依次为：参数名称、默认值、参数类型 | rt$Params$参数名称$Val |
| 输入 | 两个输入框依次为：文件引用名称、文件类型 | rt$Input$输入名称$Val |
| 输出 | 两个输入框依次为：文件引用名称、文件类型 | rt$Output$输出名称$Val |
   
下图中的“模块设置”，表示的含义如下所示：
   
- 该算法模块只有一个参数，其名称为param1，该参数的默认值为“age”，该参数的类型为“string”。
- 该算模块只有一个输入文件，在代码中其引用名称为input1，文件类型为“csv”；当该算法模块发布为分析模块后，在工作流中引用该模块时，该模块只有一个输入，且只能与输出类型为csv或any的模块相连。
- 该算法模块只有一个输出文件，其代码中其引用名称为input2，文件类型为“csv”；当该算法模块发布为分析模块后，在工作流中引用该模块时，该模块只有一个输出，且只能与输如类型为csv或any的模块相连。

 ![](/user_guide/fig/fig_36.png)

* **Python语言传参模式及规则**
   
| 模块设置 | 调用模式 |
| :--- | :--- |
| 参数 | Params.参数名称 |
| 输入 | Input.输入名称 |
| 输出 | Output.输出名称 |
  
下图中的“模块设置”，表示的含义如下所示：
   
 - 该算法模块只有三个参数，名称为param1的参数的默认值为“age”，参数类型为“string”；名称为param2的参数默认值为3.1415，参数类型为“float”；名称为param3的参数默认值为“3”，参数类型为integer。
 - 该算模块只有一个输入文件，在代码中其引用名称为input1，文件类型为“csv”；当该算法模 块发布为分析模块后，在工作流中引用该模块时，该模块只有一个输入，且只能与输出类型为csv或any的模块相连。
 - 该算法模块只有一个输出文件，其代码中其引用名称为input2，文件类型为“csv”；当该算法模块发布为分析模块后，在工作流中引用该模块时，该模块只有一个输出，且只能与输如类型为csv或any的模块相连。
    
 ![](/user_guide/fig/fig_37.png)
   
4.安装程序包。
  
系统支持上传和下载R/Python程序包。单击“包管理”，弹出 包管理对话框。例如我们本次的分析模块需要pandas程序包，通过搜索找到“pandas”，单击“安装”，系统会自动安装pandas程序包供用户调用。
  ![](/user_guide/fig/fig_38.png)
  
5.新建文件编辑代码。

将鼠标放在“文件管理”区域的根文件夹上，点击鼠标右键弹出对话框，选择“添加文件”，输入文件名称，以“run.py”为例。在代码编辑区写入模块代码，Ctrl+s保存文件。
![](/user_guide/fig/fig_39.png)

6.调试代码。

通过调试，可检测当前文件是否有语法错误、逻辑错误等；同时支持查看当前文件的运行结果。单击“请选择”下拉框的“添加”按钮，填写名称，选择需要调试的文件。如下所示的设置，表示调试时，将在容器中运行“run.py”脚本，从而检查其是否有语法错误。
![](/user_guide/fig/fig_40.png)

7.测试代码。

调试成功后可对文件进行测试。单击“测试”，弹出“发布测试”对话框。如下所示表示将“模块设置”中的输入“TrainDa”与input目录下的文件“train_dataset.csv”关联，作为调试的输入。若当前input目录下没有文件，则需要先上传文件。
![](/user_guide/fig/fig_41.png)

单击“测试”，系统会对该模块进行测试，在调试测试区查看运行结果。
![](/user_guide/fig/fig_42.png)

8.发布。

测试成功后发布模块。单击“发布”，弹出“发布”对话框，填写版本号。

9.版本控制。

分析模块的版本发布时可以自定义版本信息；系统默认从0.0版本起，之后自动加0.1。

10.版本号填写完成后单击“发布”，系统跳转到“算法定制”页面。
![](/user_guide/fig/fig_43.png)

| 创建状态 | 说明 |
| :--- | :--- |
| 编辑 | 模块处于编辑状态 |
| 发布中 | 模块处于发布状态 |
| 发布失败 | 模块发布失败 |

11.发布成功。

模块发布成功后，会自动添加到分析模块库中，此时算法定制界面不再呈现该记录。
![](/user_guide/fig/fig_44.png)

### 算法定制示例
在算法过程中，以文件作为其输入和输出。定制的算法模块发布后，在工作流中，从其上游模块中接收数据或向下游模块输出数据，这类数据是动态的，在工作流运行过程中流入或流出分析模块；此外，也可能用到静态的数据，例如在算法定制中可以引用保存在Zeppelin个人工作目录下的数据，也可以引用保存在HDFS上的数据，这类算法在发布后，在工作流运行时，依然从引用位置读取文件。这种静态文件的方式，可以用于依赖于大量数据的模型训练中，您可以更新训练数据集，但只要数据集的路径和文件名保持不变，则工作流在下次运行时将使用最新的数据集完成模型的训练。

说明：对于使用Zeppelin个人工作目录下的数据的算法，应设置为私人模块，否则若其他开发人员在工作流中引用了该模块，可能因为没有读取原开发者工作目录下数据的权限而导致整个工作流运行失败。

* 读取Zeppelin个人工作空间的Python代码示例
    - 场景说明：当前登录用户为“testuser”，在Zeppelin中其个人工作空间目录为“/mnt/nfsfile/userdata/testuser@MCIPT.COM/upload/”，如下示例给出了读写个人工作空间目录的代码样例。
    - 代码样例：
          #!/usr/bin/env python
          # -*- coding: utf-8 -*-
          def main(params, inputs, outputs):
          #如下代码向当前用户的工作空间目录的文件中写入内容
          f_w = open('/mnt/nfsfile/userdata/testuser@MCIPT.COM/upload/testfileA.txt','w+')
          f_w.write('Hello，this is a test.')
          f_w.close()
          #如下代码从当前用户的工作空间目录的文件中读取内容
          f_r = open('/mnt/nfsfile/userdata/testuser@MCIPT.COM/upload/csvfile.csv','r+')
          f = open('testfileB','w')
          f.write(f_r.read())
          f.close
          f_r.close()
       
     说明：读取的文件必须是在当前用户的工作空间下的，即路径“/mnt/nfsfile/userdata/username@MCIPT.COM/upload/”下的文件，其中username应使用实际的用户名替换。
  
* 读取HDFS的Python代码示例
    - 场景说明：在Python中，可以使用OS模块来执行操作系统命令，从而完成对HDFS上文件的读取操作。
    - 代码样例：
          import os
          import json
          def main(params, inputs, outputs):
          with open(inputs.input, 'r') as f:
               a = json.loads(f.read())
               url = a.get("URL")
               path = url[len(("/").join(url.split("/")[0:3])):]
               print path
             os.system("hdfs dsf -copyToLocal %s %s" %(path,outputs.output))

       说明：上述代码在执行时将HDFS中的文件拷贝到output中。


## 任务列表
前提条件：普通用户只能查看其创建的和其他管理员创建并为其赋予读取权限的任务。系统管理员可以查看到所有任务。

用户可以查看正在运行及历史运行任务实时掌握任务流的状况，并作出相应措施，例如执行、停止或删除任务；用户也可在具体任务中点击任务链接，跳转到相应的数据应用中进行修改。

### 查看任务列表
查看任务列表需完成以下步骤：

1.单击页面左侧导航栏“任务列表”，系统跳转到“任务列表”界面。
![](/user_guide/fig/fig_45.png)

2.调整任务列表显示内容。

   * 切换本账号创建和其他账号创建任务
   
 点击区域1中“我的”或“全部”按钮，切换显示本账号创建和其他用户创建的、本账号有权查看的任务。
 
   * 切换任务显示顺序
 系统默认以创建时间（现有序号倒序）排序。点击区域2中“序号”、“开始时间”、“名称”、“创建人”旁边的降序排列![](/user_guide/icon/descend.png)或升序排列![](/user_guide/icon/ascend.png)，设置显示任务列表的排序方式。

3.操作具体任务。

   * 启动任务
   
   单击具体任务中的启动按钮![](/user_guide/icon/start.png)， 可重新启动运行失败的任务。

   * 暂停任务
   
   单击具体任务中的暂停按钮![](/user_guide/icon/pause.png)， 可暂停正在运行的任务。
  * 删除任务
  
  单击具体任务中的删除按钮![](/user_guide/icon/delete.png)，可删除任务。

### 查看任务详情

查看任务详情需完成以下步骤：

1.单击页面左侧导航栏“任务列表”，系统跳转到“任务列表”界面。
![](/user_guide/fig/fig_46.png)

2.根据任务名称或描述，搜索显示需要查询的任务。

3.在任务名称字段单击相应的任务名称，进入任务详情界面。
![](/user_guide/fig/fig_47.png)
在任务详情界面，可以查看到具体任务的项目来源，开始时间，状态，创建人，任务耗时，以及任务的运行状态、模块列表和变量配置。

在任务名称字段单击相应的任务名称，进入任务详情界面。如果任务运行失败，还可以选择继续运行或删除此任务。

### 编辑项目来源

查看任务详情需完成以下步骤

1. 单击页面左侧导航栏“任务列表”，系统跳转到“任务列表”界面。
2. 根据任务名称或描述，搜索显示需要查询的任务。
3. 在项目来源字段单击相应的任务名称，进入数据应用界面。
这里为任务提供了相对应数据应用的链接，如果任务运行失败，可以直接在项目来源处进行数据应用的修改。

## 预定计划
用户可以查看所有定期和稍后运行的任务，以便于把握后期任务的计划排期，实现定制化任务排期时间。
### 查看预定计划
1. 单击页面左侧导航栏“预定计划”，系统跳转到“预定计划”界面。
![](/user_guide/fig/fig_48.png)
2. 调整计划列表显示内容。
 * 切换本账号创建和其他账号创建计划
  
     点击区域1中“我的”或“全部”按钮，切换显示本账号创建和其他用户创建的、本账号有权查看的计划。
 * 切换计划显示顺序
      
      系统默认以创建时间（现有序号倒序）排序。点击区域2中“序号”、“开始时间”、“名称”、“创建人”旁边的降序排列![](/user_guide/icon/descend.png)或升序排列![](/user_guide/icon/ascend.png)，设置显示计划列表的排序方式。

3. 操作具体计划。

   * 启动计划
   
   单击具体计划中的启动按钮![](/user_guide/icon/start.png)， 可重新启动运行失败的计划。

   * 暂停计划
   
   单击具体计划中的暂停按钮![](/user_guide/icon/pause.png)， 可暂停正在运行的计划。
  * 删除计划
  
  单击具体计划中的删除按钮![](/user_guide/icon/delete.png)，可删除计划。

### 查看计划详情
查看计划详情需完成以下步骤：
1. 单击页面左侧导航栏“预定计划”，系统跳转到“预定计划”界面。
![](/user_guide/fig/fig_49.png)

2. 根据计划名称或描述，搜索显示需要查询的计划。
3. 在任务名称字段单击相应的任务名称，进入计划详情界面。
![](/user_guide/fig/fig_50.png)
在计划详情界面，可以查看到具体计划的项目来源，上次运行时间，是否激活，任务名称，启动时间，任务描述，创建时间，时间间隔，状态，创建人，过期时间等。

   每当计划运行一次，系统会记录运行的相关信息。

## 交互探索
APS支持的数据处理流程包括商业理解、数据理解、数据准备、建模、评估和部署上线这几个环节，而交互探索及Zeppelin则主要用于数据理解，即用于探索数据特征、进行简单的特征统计、检验数据的质量包括数据的完整性和正确性等。在APS中，一般而言，先由数据科学家使用Zeppelin对部分样本数据进行探索分析并输出报告，然后在此基础上算法工程师、数据应用工程师等开展相关的算法定制、数据应用设计的工作。
### 概念与特性
Zeppelin是一个基于Web的可实现交互式数据分析的笔记本，它支持数据可视化、多语言后端以及笔记本的协作分享。
Zeppelin具有如下特点：
* **多用途笔记本**：
在Zeppelin中个，通过笔记本可以实现数据摄入、数据发现、数据分析、数据可视化与协作等操作。
* **多语言后端**：
Zeppelin通过解释器将任何语言/数据处理后端插入到Zeppelin中。在Zeppelin中，默认提供的解释器有Apache Spark、Python、Markdown、Shell、HDFS、Impala等。
* **Apache Spark集成**：
Zeppelin提供内置的Apache Spark集成。使用者不需要为其构建单独的模块、插件或库。
* **数据可视化**
Zeppelin中包含了一些基本图表。可视化不限于Spark SQL查询，任何语言后端的任何输出都可以被识别和可视化。
* **共享协作**
笔记本网址可以在协作者之间共享，笔记本所有者做的最新更改也会在笔记本网址上被实时同步

### 界面资源介绍

#### 首页
进入服务>交互探索，单击右上角的“login”，输入账号和密码，登录Zeppelin，首页如下图所示：
![](/user_guide/fig/fig_51.png)
* 页面左侧列出所有现有的笔记本。

    说明：每个用户Zeppelin的登录首页仅显示自己拥有的以及别人共享的笔记本。
* 单击“Import note”可以从本地磁盘或从远程位置导入您的笔记本。
* 单击“Create note”可以创建一个新的笔记本。

#### 笔记本

Zeppelin笔记本由段落组成，即笔记本可以看作是一个段落容器。
![](/user_guide/fig/fig_52.png)

#### 段落
每个段落由两部分组成，Code section用于编辑源代码，Result section用户显示代码运行结果。
![](/user_guide/fig/fig_53.png)
段落右上角按钮命令如下所示：
* 执行段落代码
* 隐藏/显示Code Section
* 隐藏/显示Result Section
* 配置段落

#### 笔记本工具栏
在笔记本顶部是一个包含显示命令以及配置、安全性和显示选项的工具栏。
![](/user_guide/fig/fig_88.png)

工具栏按钮的作用如下所示：
* 按顺序执行所有段落
* 隐藏/显示Code Section
* 隐藏/显示Result Section
* 清除所有段落的Result Section
* 克隆当前笔记本
* 将当前笔记本导出为JSON文件
* 切换到所有者模式

### Zeppelin解释器
Zeppelin解释器是一款插件，可让Zeppelin用户使用特定的语言/数据处理后端。例如，要在Zeppelin中使用Scala代码，您需要%spark解释器。
单击笔记本工具栏右侧的齿轮图标，可以查看Zeppelin已绑定的解释器，如下图所示：
![](/user_guide/fig/fig_54.png)

### Zeppelin基本操作

#### 获取Keytab
在APS中，通过解释器的形式将语言和数据处理后端插入到Zeppelin中，而这些后端一般都部署在CDH集群中。出于安全考虑，Zeppelin在访问CDH资源时必须进行认证，在APS中，认证的过程通过Keytab来实现。即用户在通过Zeppelin操作CDH资源前，需要先确保其Keytab是有效的。
1. 单击“用户中心”>“安全中心”，进入Keytab管理页面。
2. 单击“重置”，重新获取Keytab。
    系统显示类似如下信息时，说明当前用户获取的keytab是有效的。
    ![](/user_guide/fig/fig_55.png)
    
    说明：当系统显示Keytab过期或失效时必须执行本步骤中的操作，否则会导致操作CDH集群资源失败。
    
#### 查看用户环境
Zeppelin为其每个用户都创建了一个后端操作系统用户，用户名为“AD_<Zeppelin用户名>”，工作目录为/home/用户名，文件上传目录为“/home/用户名/data/upload”。
1. 选择“服务”>“分析应用”>“交互探索”，系统显示Zeppelin登录页面。
2. 输入用户名和密码登录Zeppelin。
3. 在Zeppelin登录首页单击“Create new note”，在对话框中输入note名称“User environment”并单击“创建”。
    Zeppelin完成创建后会显示该note的编辑页面。
4. 在第一个段落中使用shell解释器查看用户环境，如下图所示。
    ![](/user_guide/fig/fig_56.png)

#### 了解用户Python环境
Zeppelin为每个用户提供了默认的Python执行环境，当默认Python环境的包不满足用户的需求时，用户可以使用pip从远程仓库中安装需要的外部包。

1. 选择“服务”>“分析应用”>“交互探索”，系统显示Zeppelin登录页面。
2. 输入用户名和密码登录Zeppelin。
3. 在Zeppelin登录首页单击“Create new note”，在对话框中输入note名称“Python environment”并单击“创建”。
    Zeppelin完成创建后会显示该note的编辑页面。
4. 在第一个段落中使用shell解释器查看Python环境，如下图所示。
    ![](/user_guide/fig/fig_57.png)
    上图中显示了查看Python版本、Python执行环境以及已安装包的命令以及执行结果。
    
    当“pip list”的结果中缺少用户所需的Python包时，可以通过如下命令进行安装：
    
        pip install scikit-learn -i http://192.168.1.87:18088/simple --trusted-host 192.168.1.87
    
    上述命令表示从仓库http://192.168.1.87:18088/simple中安装scikit-learn包，请根据实际情况修改所需的包名以及仓库地址。


### R语言统计分析示例
#### 场景说明
本节使用Zeppelin的R解释器实现一个文本文件“u.user”包含的人员的职业统计分析。在该文本文件中共包含943条记录，每条记录分别由“序号”、“年龄”、“性别”、“职业”和“邮编”组成，不同字段之间使用“|”进行分割，部分样例数据如下所示：
             
    1|24|M|technician|85711
    2|53|F|other|94043
    3|23|M|writer|32067
    4|24|M|technician|43537
    5|33|F|other|15213

#### 上传并查看文件
Zeppelin为其每个用户都创建了一个后端用户，用户名为“AD_<Zeppelin用户名>”，工作目录为/home/用户名，文件上传目录为“/home/用户名/data/upload”。

1. 选择“服务”>“分析应用”>“交互探索”，系统显示Zeppelin登录页面。
2. 输入用户名和密码登录Zeppelin。
3. 在Zeppelin登录首页单击“Create new note”，在对话框中输入note名称“Base R in Apache Zepplin”并单击“创建”。
    Zeppelin完成创建后会显示该note的编辑页面。
4. 单击页面右上角的上传文件，将本地文件u.user上传到Zeppelin服务器。
    说明：在Zeppelin中，每个用户都有其独立的工作环境，每个用户上传的文件保存在其家目录下的“data/upload”目录下。
5. 在第一个段落中使用shell解释器查看文件是否成功上传。
![](/user_guide/fig/fig_58.png)

#### 编辑并运行代码
1. 新建一个段落，并输入如下代码：
     
       %spark
       val user_data = sc.textFile("data/upload/u.user")
       user_data.first()
       val user_fields = user_data.map(line => line.split("\\|"))
       val num_users = user_fields.map(fields => fields(0)).count()
       val num_genders = user_fields.map(fields => fields(2)).distinct().count()
       val num_occupations = user_fields.map(fields => fields(3)).distinct().count()
       val num_zipcodes = user_fields.map(fields => fields(4)).distinct().count()
       val count_by_occupation = user_fields.map(fields => (fields(3),1)).reduceByKey(_ + _).collect().toList.sortBy(_._2).map(line => line._1+"\t"+line._2).toList.mkString("\n")
       println("%table occupation\tsize\n" + count_by_occupation)

2. 单击段落右上角![](/user_guide/icon/run.png)运行代码，显示结果如下所示：
![](/user_guide/fig/fig_59.png)

    代码成功运行后，默认以饼图的形式展示结果，通过单击Result Section上的操作按钮，可以将结果以不同的形式展示，如下为列表样式：
![](/user_guide/fig/fig_60.png)

### Hive建表示例
####场景说明
本节使用Zeppelin的sh解释器和hive解释器将一个本地文件上传到HDFS，在Hive中创建数据表并将数据文件加载到Hive表中，从而可以通过Hive SQL进行数据探查，避免开发繁琐的MapReduce程序。本节示例使用的文本文件样例如下所示，每条记录由“股票名”、“股票类型”、“交易时间”、“价格”等字段组成，不同字段之间由“,”分割。
          
          sh600000,JRHY,2013-12-26 15:00:07,9.09,0.01,0,0,1
          sh600000,JRHY,2013-12-26 15:00:02,9.08,-0.01,40,36320,-1
          sh600000,JRHY,2013-12-26 14:59:57,9.09,0.0,718,652734,1

#### 上传并查看文件
Zeppelin为其每个用户都创建了一个后端用户，用户名为“AD_<Zeppelin用户名>”，工作目录为/home/用户名，文件上传目录为“/home/用户名/data/upload”。

1. 选择“服务”>“分析应用”>“交互探索”，系统显示Zeppelin登录页面。
2. 输入用户名和密码登录Zeppelin。
3. 在Zeppelin登录首页单击“Create new note”，在对话框中输入note名称“File_import_to_Hive”并单击“创建”。
    Zeppelin完成创建后会显示该note的编辑页面。
4. 单击页面右上角的上传文件，将本地文件stock_data.csv上传到Zeppelin服务器。
    说明：在Zeppelin中，每个用户都有其独立的工作环境，每个用户上传的文件保存在其家目录下的“data/upload”目录下。
5. 在第一个段落中使用shell解释器查看文件是否成功上传。
![](/user_guide/fig/fig_61.png)

#### 编辑并运行代码
1. 新建一个段落，并输入如下代码，将文本文件上传到HDFS的/tmp目录下：
    
         %sh
         hdfs dfs -put data/upload/stock_data.csv /tmp
2. 新建一个段落，并输入如下代码，在Hive中创建数据库与表结构：

        %hive
        CREATE DATABASE  zet;
        %hive
        create table zet.stock_everydate_detail4
        (
        stock_name string,
        stock_type string,
        trans_time string,
        price double,
        up_or_down_price double,
        trans_count bigint,
        trans_nmoney bigint,
        trans_type string
        )
        PARTITIONED BY(dt String) ROW FORMAT DELIMITED FIELDS TERMINATED BY ',';
3. 新建一个段落，并输入如下代码，将HDFS中的数据文件加载到已创建的Hive表中，并进行查看：

        %hive
        LOAD DATA INPATH '/tmp/stock_data.csv' INTO TABLE             zet.stock_everydate_detail4  PARTITION (dt='201312');
        use zet;

        select * from zet.stock_everydate_detail4 limit 10;

4. 单击段落右上角的![](/user_guide/icon/run.png)运行代码，显示结果如下所示：

![](/user_guide/fig/fig_62.png)

    代码成功运行后，以表格的形式展示表的前10行数据。也可以在hive解释器中执行其它Hive SQL对数据进行高效的查询和探查。














